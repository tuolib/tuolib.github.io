import{c as R,i as U,V as G,P as j,G as q,a as W}from"./use-translate.a196871a.js";import{t as D,b as H,m as T,c as X,w as N,d as ee,a as I}from"./with-install.a0bab54c.js";import{C as oe}from"./index.abc86992.js";import{A as P,e as o,D as p,x as g,y as _,N as ne,j as te,v as ae,q as se,r as ce,o as ue,c as le,w as z,C}from"./vue-libs.fd74807a.js";import{V as ie}from"./index.f37d16f9.js";import{u as re}from"./use-refs.0cf5deac.js";import{T as de,a as Y}from"./index.6c8df2ad.js";import{F as pe}from"./index.82ad6040.js";import{B as O}from"./index.93cac71d.js";import{C as me}from"./index.2fe75897.js";import{T as he}from"./function-call.33ac04a1.js";import"./use-route.e217ff91.js";import"./index.75bcb902.js";import"./constant.80c6de18.js";import"./interceptor.2cd9e46b.js";import"./use-expose.c7cd3ed1.js";import"./use-touch.0eed9279.js";import"./use-lazy-render.9a7d5f45.js";import"./on-popup-reopen.0f034b19.js";import"./index.36766f9d.js";import"./use-id.c3e45cc3.js";import"./index.6f3320db.js";import"./index.d96cd329.js";import"./index.e0b746cb.js";import"./Checker.43ee3aa3.js";import"./mount-component.f6c89a43.js";const[ge,Z,M]=R("coupon-cell"),ve={title:String,border:D,editable:D,coupons:H(),currency:T("\xA5"),chosenCoupon:X(-1)};function Ce({coupons:e,chosenCoupon:t,currency:l}){const s=e[+t];if(s){let n=0;return U(s.value)?{value:n}=s:U(s.denominations)&&(n=s.denominations),`-${l} ${(n/100).toFixed(2)}`}return e.length===0?M("noCoupon"):M("count",e.length)}const be=P({name:ge,props:ve,setup(e){return()=>{const t=e.coupons[+e.chosenCoupon];return o(oe,{class:Z(),value:Ce(e),title:e.title||M("title"),border:e.border,isLink:e.editable,valueClass:Z("value",{selected:t})},null)}}}),fe=N(be),xe=fe;function J(e){const t=new Date(e*1e3);return`${t.getFullYear()}.${G(t.getMonth()+1)}.${G(t.getDate())}`}const ye=e=>(e/10).toFixed(e%10===0?0:1),K=e=>(e/100).toFixed(e%100===0?0:e%10===0?1:2),[Be,r,V]=R("coupon"),we=P({name:Be,props:{chosen:Boolean,coupon:ee(Object),disabled:Boolean,currency:T("\xA5")},setup(e){const t=p(()=>{const{startAt:n,endAt:c}=e.coupon;return`${J(n)} - ${J(c)}`}),l=p(()=>{const{coupon:n,currency:c}=e;if(n.valueDesc)return[n.valueDesc,o("span",null,[n.unitDesc||""])];if(n.denominations){const u=K(n.denominations);return[o("span",null,[c]),` ${u}`]}return n.discount?V("discount",ye(n.discount)):""}),s=p(()=>{const n=K(e.coupon.originCondition||0);return n==="0"?V("unlimited"):V("condition",n)});return()=>{const{chosen:n,coupon:c,disabled:u}=e,h=u&&c.reason||c.description;return o("div",{class:r({disabled:u})},[o("div",{class:r("content")},[o("div",{class:r("head")},[o("h2",{class:r("amount")},[l.value]),o("p",{class:r("condition")},[c.condition||s.value])]),o("div",{class:r("body")},[o("p",{class:r("name")},[c.name]),o("p",{class:r("valid")},[t.value]),!u&&o(me,{class:r("corner"),modelValue:n},null)])]),h&&o("p",{class:r("description")},[h])])}}}),Q=N(we),[De,d,x]=R("coupon-list"),Te="https://img.yzcdn.cn/vant/coupon-empty.png",ke={code:T(""),coupons:H(),currency:T("\xA5"),showCount:D,emptyImage:T(Te),chosenCoupon:I(-1),enabledTitle:String,disabledTitle:String,disabledCoupons:H(),showExchangeBar:D,showCloseButton:D,closeButtonText:String,inputPlaceholder:String,exchangeMinLength:I(1),exchangeButtonText:String,displayedCouponIndex:I(-1),exchangeButtonLoading:Boolean,exchangeButtonDisabled:Boolean},Ee=P({name:De,props:ke,emits:["change","exchange","update:code"],setup(e,{emit:t,slots:l}){const[s,n]=re(),c=g(),u=g(),h=g(0),y=g(0),i=g(e.code),k=p(()=>!e.exchangeButtonLoading&&(e.exchangeButtonDisabled||!i.value||i.value.length<e.exchangeMinLength)),E=()=>{const m=q(c).height,f=q(u).height+44;y.value=(m>f?m:j.value)-f},S=()=>{t("exchange",i.value),e.code||(i.value="")},$=a=>{se(()=>{var m;return(m=s.value[a])==null?void 0:m.scrollIntoView()})},v=()=>o("div",{class:d("empty")},[o("img",{src:e.emptyImage},null),o("p",null,[x("noCoupon")])]),b=()=>{if(e.showExchangeBar)return o("div",{ref:u,class:d("exchange-bar")},[o(pe,{modelValue:i.value,"onUpdate:modelValue":a=>i.value=a,clearable:!0,border:!1,class:d("field"),placeholder:e.inputPlaceholder||x("placeholder"),maxlength:"20"},null),o(O,{plain:!0,type:"danger",class:d("exchange"),text:e.exchangeButtonText||x("exchange"),loading:e.exchangeButtonLoading,disabled:k.value,onClick:S},null)])},A=()=>{const{coupons:a}=e,m=e.showCount?` (${a.length})`:"",f=(e.enabledTitle||x("enable"))+m;return o(Y,{title:f},{default:()=>{var B;return[o("div",{class:d("list",{"with-bottom":e.showCloseButton}),style:{height:`${y.value}px`}},[a.map((w,L)=>o(Q,{key:w.id,ref:n(L),coupon:w,chosen:L===e.chosenCoupon,currency:e.currency,onClick:()=>t("change",L)},null)),!a.length&&v(),(B=l["list-footer"])==null?void 0:B.call(l)])]}})},F=()=>{const{disabledCoupons:a}=e,m=e.showCount?` (${a.length})`:"",f=(e.disabledTitle||x("disabled"))+m;return o(Y,{title:f},{default:()=>{var B;return[o("div",{class:d("list",{"with-bottom":e.showCloseButton}),style:{height:`${y.value}px`}},[a.map(w=>o(Q,{disabled:!0,key:w.id,coupon:w,currency:e.currency},null)),!a.length&&v(),(B=l["disabled-list-footer"])==null?void 0:B.call(l)])]}})};return _(()=>e.code,a=>{i.value=a}),_(j,E),_(i,a=>t("update:code",a)),_(()=>e.displayedCouponIndex,$),ne(()=>{E(),$(e.displayedCouponIndex)}),()=>o("div",{ref:c,class:d()},[b(),o(de,{active:h.value,"onUpdate:active":a=>h.value=a,class:d("tab")},{default:()=>[A(),F()]}),o("div",{class:d("bottom")},[te(o(O,{round:!0,block:!0,type:"danger",class:d("close"),text:e.closeButtonText||x("close"),onClick:()=>t("change",-1)},null),[[ae,e.showCloseButton]])])])}}),$e=N(Ee),Fe=$e,no=P({__name:"index",setup(e){const t=W({"zh-CN":{coupon:{name:"\u4F18\u60E0\u5238\u540D\u79F0",reason:"\u4F18\u60E0\u5238\u4E0D\u53EF\u7528\u539F\u56E0",description:"\u63CF\u8FF0\u4FE1\u606F"},exchange:"\u5151\u6362\u6210\u529F"},"en-US":{coupon:{name:"Coupon name",reason:"Coupon unavailable reason",description:"Description"},exchange:"Success"}}),l=(v=999999)=>String(Math.floor(Math.random()*v)+1),s=g(!1),n=g(-1),c=g([]),u=p(()=>({id:1,condition:`\u65E0\u95E8\u69DB
\u6700\u591A\u4F18\u60E012\u5143`,reason:"",value:150,name:t("coupon.name"),description:t("coupon.description"),startAt:1489104e3,endAt:1514592e3,valueDesc:"1.5",unitDesc:"\u5143"})),h=p(()=>({...u.value,id:2,value:12,valueDesc:"8.8",unitDesc:"\u6298"})),y=p(()=>({...u.value,id:3,reason:t("coupon.reason")})),i=p(()=>({...h.value,valueDesc:"1",unitDesc:"\u6298",id:4,reason:t("coupon.reason")})),k=p(()=>[u.value,h.value,...c.value]),E=p(()=>[y.value,i.value]),S=v=>{s.value=!1,n.value=v},$=()=>{he(t("exchange")),c.value.push({...u.value,id:l()})};return(v,b)=>{const A=ce("demo-block");return ue(),le(A,{title:C(t)("basicUsage")},{default:z(()=>[o(C(xe),{coupons:C(k),"chosen-coupon":n.value,onClick:b[0]||(b[0]=F=>s.value=!0)},null,8,["coupons","chosen-coupon"]),o(C(ie),{show:s.value,"onUpdate:show":b[1]||(b[1]=F=>s.value=F),round:"",position:"bottom",style:{height:"90%","padding-top":"4px"}},{default:z(()=>[o(C(Fe),{coupons:C(k),"chosen-coupon":n.value,"disabled-coupons":C(E),onChange:S,onExchange:$},null,8,["coupons","chosen-coupon","disabled-coupons"])]),_:1},8,["show"])]),_:1},8,["title"])}}});export{no as default};
